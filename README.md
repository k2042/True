# Описание решения

Истолковал задание в первую очередь как построение микросервисного решения с указанными архитектурными требованиями,
поэтому детали безопасности, валидации и маппинга данных опущены.

## 1. Запуск

- Решение построено на **.net 8** с использованием **Aspire**.
- Стартовый проект **True.Orchestrator**
- Для запуска требуется установленный **Docker Desktop** и **.net 8 SDK**
- Проверено на сборку в **VS 2022** вне ПК разработки

## 2. Использование

- После запуска нужно дождаться завершения работы сервиса **MigratorJob** и статуса **Healthy** по остальным ресурсам.
- Можно не ждать **pgadmin**, он поднимается с задержкой, но не влияет на работоспособность решения.
- База **true_db** при запуске всегда пересоздаётся заново и заполняется первичными данными.
- Можно переходить по URL поднявшихся ресурсов и работать с вызовами API через интерфейс Scalar.

## 3. Функционал

### Ресурс IntegrationCbr - True.Integration.Cbr

Загрузчик данных по курсам валют. По умолчанию сконфигурирован на загрузку раз в сутки.
Для ручного вызова триггера фоновой задачи выставлен внутренний эндпоинт **/api/trigger** - авторизация не требуется.

### Ресурс GatewayApi - True.Gateway.Api

API Gateway для всего функционала решения

В задаче указана реализация регистрации, входа и выхода пользователя через микросервис пользователя,
но также указано использовать API Gateway. Счёл логичным управление авторизацией реализовать на строне API Gateway,
если уж отсутствует SSO, а микросервис пользователя использовать как внутреннее хранилище для аккаунтов.

- POST /api/users/register - без авторизации, регистрация пользователя
- POST /api/users/login - без авторизации, логин пользователя, установка Cookie, выдача JWT
- POST /api/users/logout - авторизация по Cookie

В БД на старте уже заведены пользователи:
	- root:Admin!
	- user:User!
Срок действия Cookie 1 день (скользящий).
Cookie сохраняется между сессиями (перезапусками решения).

- GET /api/token/refresh - авторизация по Cookie, выдача JWT

Срок действия JWT 5 минут.

- GET /api/currencies - получение списка валют, авторизация по JWT

Поскольку требованиями не было определено, как для пользователя определяются его избранные валюты, реализован
минимальный вариант - пользователь сам знает, какие ему нужны валюты, метод ожидает строку запроса, например:

- GET /api/currencies?favorites=aud,amd,eur

Допустимы разделители ",;|- "


### Внутренние ресурсы

#### UserApi - True.Users.Api

Функционал:
- /api/users/register - без авторизации
- /api/users/login - без авторизации

logout реализован на стороне API gateway, так как не требует проверки по внутренним данным микросервиса.

#### FinanceApi - True.Finance.Api

Функционал:
- GET /api/currencies - получение списка валют, авторизация по JWT